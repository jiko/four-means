<html>
	<head>
	<title>Four Means &mdash; Tumblr condensed</title>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mithril/0.1.13/mithril.min.js"></script>
    <style>
      * { border:0; padding:0; margin:0; }
      div { height:100%; width:25%; float:left; }
      .gh { position: absolute; top: 0; right: 0; border: 0; }
      #ul { position: absolute; top: 0; left: 0; text-decoration: none;
            background-color: #000; color: #fff; font-size: 24px; padding: 0.5em; }
    </style>
	</head>
	<body>
        <a href="https://github.com/jiko/four-means">
          <img class="gh" alt="Fork me on GitHub" src="forkme_right_white_ffffff.png">
        </a>
        <a id="prev" href="#">
          <div></div>
          <div></div>
        </a>
        <a id="next" href="#">
          <div></div>
          <div></div>
        </a>
        <a id="ul" href="list.html">List Index</a>
    </body>
    <script>
      var pages  = Array();
      var colors = Array();
      var index  = 0;
      var prev, next;

      var changebg = function(page) {
        var in_list = pages.indexOf(page);
        if (in_list === -1) {
          page = pages[index];
        } else {
          index = in_list;
        }
        var prev_index = (index === 0) ? pages.length-1 : index-1;
        var next_index = (index === pages.length-1) ? 0 : index+1;
        document.title = "Four means " + page.replace(/-/g,' ');
        divs = document.getElementsByTagName("div");
        for (var i = 0; i < divs.length; i++) {
            divs[i].setAttribute("style", "background-color:"+colors[index][i]);
        }
        next.setAttribute("href", "#"+pages[next_index]);
        prev.setAttribute("href", "#"+pages[prev_index]);
      };
      var addClickEvent = function(link) {
        link.addEventListener("click", function(e) { 
          e.preventDefault();
          page = link.getAttribute("href").slice(1)
          changebg(page);
          history.pushState({ page: page }, page, "#"+page);
        });
      };
      m.request({method: "GET", url: "colors.json"}).then(function(data) {
        for (var key in data) {
            pages.push(key);
            colors.push(data[key]);
        }
        var page = location.hash.slice(1) || pages[Math.floor(Math.random() * pages.length)];
        history.pushState({ page: page }, page, "#"+page);
        changebg(page);
      });
      next = document.getElementById("next");
      addClickEvent(next);
      prev = document.getElementById("prev");
      addClickEvent(prev);
      window.setTimeout(function() {
        window.addEventListener("popstate", function(e) {
          changebg(location.hash.slice(1));
        }, false);
      }, 1);
    </script>
</html>
